{"visual":{"name":"R Pivot Table","displayName":"R Pivot Table","guid":"rPivotTable8B3D024D64314B469FFC4852A7ACBD5F_DEBUG","visualClassName":"Visual","version":"1.0.2.1","description":"R Pivot Table from BlueGranite","supportUrl":"https://deldersveld.github.io/powerbi/support/r-pivot-table","gitHubUrl":"https://github.com/BlueGranite/RPivotTable-for-Power-BI"},"apiVersion":"1.10.0","author":{"name":"BlueGranite","email":"support@blue-granite.com"},"assets":{"icon":"assets/icon.png"},"externalJS":["node_modules/powerbi-visuals-utils-dataviewutils/lib/index.js"],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Values","kind":"GroupingOrMeasure","name":"Values"}],"dataViewMappings":[{"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"Values"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"html","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"############### Utility functions ###############\nlibraryRequireInstall = function(packageName, ...)\n{\n  if(!require(packageName, character.only = TRUE)) \n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\", sep=\"\"))\n}\n\nlibraryRequireInstall(\"XML\")\nlibraryRequireInstall(\"htmlwidgets\")\n\ninternalSaveWidget <- function(widget, fname)\n{\n  tempFname = paste(fname, \".tmp\", sep=\"\")\n  htmlwidgets::saveWidget(widget, file = tempFname, selfcontained = FALSE)\n  FlattenHTML(tempFname, fname)\n}\n\nFlattenHTML <- function(fnameIn, fnameOut)\n{\n  # Read and parse HTML file\n  # Embed all js and css files into one unified file\n  \n  if(!file.exists(fnameIn))\n    return(FALSE)\n  \n  dir = dirname(fnameIn)\n  html = htmlTreeParse(fnameIn, useInternal = TRUE)\n  top = xmlRoot(html)\n  \n  # extract all <script> tags with src value\n  srcNode=getNodeSet(top, '//script[@src]')\n  for (node in srcNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['src'])\n    alternateSrc = FindSrcReplacement(fname)\n    if (!is.null(alternateSrc))\n    {\n      s = alternateSrc\n      names(s) = 'src'\n      newNode = xmlNode(\"script\",attrs = s)\n      replaceNodes(node, newNode)\n    }else{\n      str=ReadFileForEmbedding(fname);\n      if (!is.null(str))\n      {      \n        newNode = xmlNode(\"script\", str, attrs = c(type = \"text/javascript\"))\n        replaceNodes(node, newNode)\n      }\n    }\n  }\n  \n  # extract all <link> tags with src value\n  linkNode=getNodeSet(top, '//link[@href]')\n  for (node in linkNode)\n  {\n    b = xmlAttrs(node)\n    fname = file.path(dir, b['href'])\n    str = ReadFileForEmbedding(fname, FALSE);\n    if (!is.null(str))\n    {\n      newNode = xmlNode(\"style\", str)\n      replaceNodes(node, newNode)\n    }\n  }\n  \n  saveXML(html, file = fnameOut)\n  return(TRUE)\n}\n\nReadFileForEmbedding <- function(fname, addCdata = TRUE)\n{\n  data = ReadFullFile(fname)\n  if (is.null(data))\n    return(NULL)\n\n  str = paste(data, collapse ='\\n')\n  if (addCdata) {\n    str = paste(cbind('// <![CDATA[', str,'// ]]>'), collapse ='\\n')\n  }\n  return(str)\n}\n\nReadFullFile <- function(fname)\n{\n  if(!file.exists(fname))\n    return(NULL)\n  \n  con = file(fname, open = \"r\")\n  data = readLines(con)\n  close(con)\n  return(data)\n}\n\nFindSrcReplacement <- function(str)\n{\n  # finds reference to 'plotly' js and replaces with a version from CDN\n  # This allows the HTML to be smaller, since this script is not fully embedded in it\n  str <- iconv(str, to=\"UTF-8\")\n  pattern = \"plotlyjs-(\\\\w.+)/plotly-latest.min.js\"\n  match1=regexpr(pattern, str)\n  attr(match1, 'useBytes') <- FALSE\n  strMatch=regmatches(str, match1, invert = FALSE)\n  if (length(strMatch) == 0) return(NULL)\n  \n  pattern2 = \"-(\\\\d.+)/\"\n  match2 = regexpr(pattern2, strMatch[1])\n  attr(match2, 'useBytes') <- FALSE\n  strmatch = regmatches(strMatch[1], match2)\n  if (length(strmatch) == 0) return(NULL)\n  \n  # CDN url is https://cdn.plot.ly/plotly-<Version>.js\n  # This matches the specific version used in the plotly package used.\n  verstr = substr(strmatch, 2, nchar(strmatch)-1)\n  str = paste('https://cdn.plot.ly/plotly-', verstr,'.min.js', sep='')\n  return(str)\n}\n#################################################\n\n\n############### Library Declarations ###############\nlibraryRequireInstall(\"plotly\");\nlibraryRequireInstall(\"jsonlite\");\nlibraryRequireInstall(\"rpivotTable\");\n####################################################\n\n################### Actual code ####################\ninitial_renderer <- \"Table\";\ninitial_agg <- \"Count\";\ninitial_vals <- \"\";\ninitial_row <- colnames(Values)[1];\ninitial_column <- colnames(Values)[2];\ninitial_row_order <- \"key_a_to_z\";\ninitial_col_order <- \"key_a_to_z\";\n\nif (exists(\"internal_settings_settings\"))\n{\n\tuser_persisted_settings <- fromJSON(internal_settings_settings);\n\t\n\tinitial_renderer <- user_persisted_settings$rendererName;\n\tinitial_agg <- user_persisted_settings$aggregatorName;\n\tinitial_vals <- user_persisted_settings$vals;\n\tinitial_row <- user_persisted_settings$rows;\n\tinitial_column <- user_persisted_settings$cols;\n\tinitial_row_order <- user_persisted_settings$rowOrder;\n\tinitial_col_order <- user_persisted_settings$colOrder;\n}\n\np <- rpivotTable(Values, \n\t\trows = initial_row, \n\t\tcols = initial_column,\n        vals = initial_vals,\n\t\taggregatorName  = initial_agg,\n\t\trendererName = initial_renderer,\n\t\trowOrder = initial_row_order,\n\t\tcolOrder = initial_col_order,\n\t\twidth = \"100%\", \n\t\theight = \"75vh\"\n\t);\n####################################################\n\n############# Create and save widget ###############\ninternalSaveWidget(p, 'out.html');\n####################################################\n"}}}],"objects":{"internal_settings":{"properties":{"settings":{"type":{"text":true}}}},"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}},"settings_rpivottable_params":{"displayName":"Visual Settings","description":"Settings to control the look and feel of R Pivot Table by BlueGranite","properties":{"fontSize":{"displayName":"Font size","description":"Adjust the font size for rows, columns, values, and totals","type":{"enumeration":[{"displayName":"10","value":"10px"},{"displayName":"12","value":"12px"},{"displayName":"14","value":"14px"},{"displayName":"16","value":"16px"},{"displayName":"18","value":"18px"},{"displayName":"20","value":"20px"}]}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"ggplot2","displayName":"GG Plot 2","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"},{"name":"plotly","displayName":"Plotly","url":"https://cran.r-project.org/web/packages/plotly/index.html"},{"name":"htmlwidgets","displayName":"HTML Widgets","url":"https://cran.r-project.org/web/packages/htmlwidgets/index.html"},{"name":"XML","displayName":"XML","url":"https://cran.r-project.org/web/packages/XML/index.html"},{"name":"rpivotTable","displayName":"rpivotTable","url":"https://cran.r-project.org/web/packages/rpivotTable/index.html"}]},"stringResources":{},"content":{"js":"/*\r\n *  Power BI Visualizations\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var utils;\r\n        (function (utils) {\r\n            var dataview;\r\n            (function (dataview) {\r\n                // TODO: refactor & focus DataViewTransform into a service with well-defined dependencies.\r\n                var DataViewTransform;\r\n                (function (DataViewTransform) {\r\n                    // TODO: refactor this, setGrouped, and groupValues to a test helper to stop using it in the product\r\n                    function createValueColumns(values, valueIdentityFields, source) {\r\n                        if (values === void 0) { values = []; }\r\n                        var result = values;\r\n                        setGrouped(result);\r\n                        if (valueIdentityFields) {\r\n                            result.identityFields = valueIdentityFields;\r\n                        }\r\n                        if (source) {\r\n                            result.source = source;\r\n                        }\r\n                        return result;\r\n                    }\r\n                    DataViewTransform.createValueColumns = createValueColumns;\r\n                    function setGrouped(values, groupedResult) {\r\n                        values.grouped = groupedResult\r\n                            ? function () { return groupedResult; }\r\n                            : function () { return groupValues(values); };\r\n                    }\r\n                    DataViewTransform.setGrouped = setGrouped;\r\n                    /** Group together the values with a common identity. */\r\n                    function groupValues(values) {\r\n                        var groups = [], currentGroup;\r\n                        for (var i = 0, len = values.length; i < len; i++) {\r\n                            var value = values[i];\r\n                            if (!currentGroup || currentGroup.identity !== value.identity) {\r\n                                currentGroup = {\r\n                                    values: []\r\n                                };\r\n                                if (value.identity) {\r\n                                    currentGroup.identity = value.identity;\r\n                                    var source = value.source;\r\n                                    // allow null, which will be formatted as (Blank).\r\n                                    if (source.groupName !== undefined) {\r\n                                        currentGroup.name = source.groupName;\r\n                                    }\r\n                                    else if (source.displayName) {\r\n                                        currentGroup.name = source.displayName;\r\n                                    }\r\n                                }\r\n                                groups.push(currentGroup);\r\n                            }\r\n                            currentGroup.values.push(value);\r\n                        }\r\n                        return groups;\r\n                    }\r\n                    DataViewTransform.groupValues = groupValues;\r\n                })(DataViewTransform = dataview.DataViewTransform || (dataview.DataViewTransform = {}));\r\n            })(dataview = utils.dataview || (utils.dataview = {}));\r\n        })(utils = extensibility.utils || (extensibility.utils = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n/*\r\n *  Power BI Visualizations\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var utils;\r\n        (function (utils) {\r\n            var dataview;\r\n            (function (dataview) {\r\n                var DataRoleHelper;\r\n                (function (DataRoleHelper) {\r\n                    function getMeasureIndexOfRole(grouped, roleName) {\r\n                        if (!grouped || !grouped.length) {\r\n                            return -1;\r\n                        }\r\n                        var firstGroup = grouped[0];\r\n                        if (firstGroup.values && firstGroup.values.length > 0) {\r\n                            for (var i = 0, len = firstGroup.values.length; i < len; ++i) {\r\n                                var value = firstGroup.values[i];\r\n                                if (value && value.source) {\r\n                                    if (hasRole(value.source, roleName)) {\r\n                                        return i;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        return -1;\r\n                    }\r\n                    DataRoleHelper.getMeasureIndexOfRole = getMeasureIndexOfRole;\r\n                    function getCategoryIndexOfRole(categories, roleName) {\r\n                        if (categories && categories.length) {\r\n                            for (var i = 0, ilen = categories.length; i < ilen; i++) {\r\n                                if (hasRole(categories[i].source, roleName)) {\r\n                                    return i;\r\n                                }\r\n                            }\r\n                        }\r\n                        return -1;\r\n                    }\r\n                    DataRoleHelper.getCategoryIndexOfRole = getCategoryIndexOfRole;\r\n                    function hasRole(column, name) {\r\n                        var roles = column.roles;\r\n                        return roles && roles[name];\r\n                    }\r\n                    DataRoleHelper.hasRole = hasRole;\r\n                    function hasRoleInDataView(dataView, name) {\r\n                        return dataView != null\r\n                            && dataView.metadata != null\r\n                            && dataView.metadata.columns\r\n                            && dataView.metadata.columns.some(function (c) { return c.roles && c.roles[name] !== undefined; }); // any is an alias of some\r\n                    }\r\n                    DataRoleHelper.hasRoleInDataView = hasRoleInDataView;\r\n                    function hasRoleInValueColumn(valueColumn, name) {\r\n                        return valueColumn\r\n                            && valueColumn.source\r\n                            && valueColumn.source.roles\r\n                            && (valueColumn.source.roles[name] === true);\r\n                    }\r\n                    DataRoleHelper.hasRoleInValueColumn = hasRoleInValueColumn;\r\n                })(DataRoleHelper = dataview.DataRoleHelper || (dataview.DataRoleHelper = {}));\r\n            })(dataview = utils.dataview || (utils.dataview = {}));\r\n        })(utils = extensibility.utils || (extensibility.utils = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n/*\r\n *  Power BI Visualizations\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var utils;\r\n        (function (utils) {\r\n            var dataview;\r\n            (function (dataview) {\r\n                var DataViewObject;\r\n                (function (DataViewObject) {\r\n                    function getValue(object, propertyName, defaultValue) {\r\n                        if (!object) {\r\n                            return defaultValue;\r\n                        }\r\n                        var propertyValue = object[propertyName];\r\n                        if (propertyValue === undefined) {\r\n                            return defaultValue;\r\n                        }\r\n                        return propertyValue;\r\n                    }\r\n                    DataViewObject.getValue = getValue;\r\n                    /** Gets the solid color from a fill property using only a propertyName */\r\n                    function getFillColorByPropertyName(object, propertyName, defaultColor) {\r\n                        var value = getValue(object, propertyName);\r\n                        if (!value || !value.solid) {\r\n                            return defaultColor;\r\n                        }\r\n                        return value.solid.color;\r\n                    }\r\n                    DataViewObject.getFillColorByPropertyName = getFillColorByPropertyName;\r\n                })(DataViewObject = dataview.DataViewObject || (dataview.DataViewObject = {}));\r\n            })(dataview = utils.dataview || (utils.dataview = {}));\r\n        })(utils = extensibility.utils || (extensibility.utils = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n/*\r\n *  Power BI Visualizations\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var utils;\r\n        (function (utils) {\r\n            var dataview;\r\n            (function (dataview) {\r\n                var DataViewObjects;\r\n                (function (DataViewObjects) {\r\n                    /** Gets the value of the given object/property pair. */\r\n                    function getValue(objects, propertyId, defaultValue) {\r\n                        if (!objects) {\r\n                            return defaultValue;\r\n                        }\r\n                        return dataview.DataViewObject.getValue(objects[propertyId.objectName], propertyId.propertyName, defaultValue);\r\n                    }\r\n                    DataViewObjects.getValue = getValue;\r\n                    /** Gets an object from objects. */\r\n                    function getObject(objects, objectName, defaultValue) {\r\n                        if (objects && objects[objectName]) {\r\n                            return objects[objectName];\r\n                        }\r\n                        return defaultValue;\r\n                    }\r\n                    DataViewObjects.getObject = getObject;\r\n                    /** Gets the solid color from a fill property. */\r\n                    function getFillColor(objects, propertyId, defaultColor) {\r\n                        var value = getValue(objects, propertyId);\r\n                        if (!value || !value.solid) {\r\n                            return defaultColor;\r\n                        }\r\n                        return value.solid.color;\r\n                    }\r\n                    DataViewObjects.getFillColor = getFillColor;\r\n                    function getCommonValue(objects, propertyId, defaultValue) {\r\n                        var value = getValue(objects, propertyId, defaultValue);\r\n                        if (value && value.solid) {\r\n                            return value.solid.color;\r\n                        }\r\n                        if (value === undefined\r\n                            || value === null\r\n                            || (typeof value === \"object\" && !value.solid)) {\r\n                            return defaultValue;\r\n                        }\r\n                        return value;\r\n                    }\r\n                    DataViewObjects.getCommonValue = getCommonValue;\r\n                })(DataViewObjects = dataview.DataViewObjects || (dataview.DataViewObjects = {}));\r\n            })(dataview = utils.dataview || (utils.dataview = {}));\r\n        })(utils = extensibility.utils || (extensibility.utils = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n/*\r\n *  Power BI Visualizations\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var utils;\r\n        (function (utils) {\r\n            var dataview;\r\n            (function (dataview) {\r\n                // powerbi.extensibility.utils.dataview\r\n                var DataRoleHelper = powerbi.extensibility.utils.dataview.DataRoleHelper;\r\n                var converterHelper;\r\n                (function (converterHelper) {\r\n                    function categoryIsAlsoSeriesRole(dataView, seriesRoleName, categoryRoleName) {\r\n                        if (dataView.categories && dataView.categories.length > 0) {\r\n                            // Need to pivot data if our category soure is a series role\r\n                            var category = dataView.categories[0];\r\n                            return category.source &&\r\n                                DataRoleHelper.hasRole(category.source, seriesRoleName) &&\r\n                                DataRoleHelper.hasRole(category.source, categoryRoleName);\r\n                        }\r\n                        return false;\r\n                    }\r\n                    converterHelper.categoryIsAlsoSeriesRole = categoryIsAlsoSeriesRole;\r\n                    function getSeriesName(source) {\r\n                        return (source.groupName !== undefined)\r\n                            ? source.groupName\r\n                            : source.queryName;\r\n                    }\r\n                    converterHelper.getSeriesName = getSeriesName;\r\n                    function isImageUrlColumn(column) {\r\n                        var misc = getMiscellaneousTypeDescriptor(column);\r\n                        return misc != null && misc.imageUrl === true;\r\n                    }\r\n                    converterHelper.isImageUrlColumn = isImageUrlColumn;\r\n                    function isWebUrlColumn(column) {\r\n                        var misc = getMiscellaneousTypeDescriptor(column);\r\n                        return misc != null && misc.webUrl === true;\r\n                    }\r\n                    converterHelper.isWebUrlColumn = isWebUrlColumn;\r\n                    function getMiscellaneousTypeDescriptor(column) {\r\n                        return column\r\n                            && column.type\r\n                            && column.type.misc;\r\n                    }\r\n                    converterHelper.getMiscellaneousTypeDescriptor = getMiscellaneousTypeDescriptor;\r\n                    function hasImageUrlColumn(dataView) {\r\n                        if (!dataView || !dataView.metadata || !dataView.metadata.columns || !dataView.metadata.columns.length) {\r\n                            return false;\r\n                        }\r\n                        return dataView.metadata.columns.some(function (column) { return isImageUrlColumn(column) === true; });\r\n                    }\r\n                    converterHelper.hasImageUrlColumn = hasImageUrlColumn;\r\n                })(converterHelper = dataview.converterHelper || (dataview.converterHelper = {}));\r\n            })(dataview = utils.dataview || (utils.dataview = {}));\r\n        })(utils = extensibility.utils || (extensibility.utils = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n/*\r\n *  Power BI Visualizations\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var utils;\r\n        (function (utils) {\r\n            var dataview;\r\n            (function (dataview) {\r\n                var DataViewObjectsParser = (function () {\r\n                    function DataViewObjectsParser() {\r\n                    }\r\n                    DataViewObjectsParser.getDefault = function () {\r\n                        return new this();\r\n                    };\r\n                    DataViewObjectsParser.createPropertyIdentifier = function (objectName, propertyName) {\r\n                        return {\r\n                            objectName: objectName,\r\n                            propertyName: propertyName\r\n                        };\r\n                    };\r\n                    DataViewObjectsParser.parse = function (dataView) {\r\n                        var dataViewObjectParser = this.getDefault(), properties;\r\n                        if (!dataView || !dataView.metadata || !dataView.metadata.objects) {\r\n                            return dataViewObjectParser;\r\n                        }\r\n                        properties = dataViewObjectParser.getProperties();\r\n                        for (var objectName in properties) {\r\n                            for (var propertyName in properties[objectName]) {\r\n                                var defaultValue = dataViewObjectParser[objectName][propertyName];\r\n                                dataViewObjectParser[objectName][propertyName] = dataview.DataViewObjects.getCommonValue(dataView.metadata.objects, properties[objectName][propertyName], defaultValue);\r\n                            }\r\n                        }\r\n                        return dataViewObjectParser;\r\n                    };\r\n                    DataViewObjectsParser.isPropertyEnumerable = function (propertyName) {\r\n                        return !DataViewObjectsParser.InnumerablePropertyPrefix.test(propertyName);\r\n                    };\r\n                    DataViewObjectsParser.enumerateObjectInstances = function (dataViewObjectParser, options) {\r\n                        var dataViewProperties = dataViewObjectParser && dataViewObjectParser[options.objectName];\r\n                        if (!dataViewProperties) {\r\n                            return [];\r\n                        }\r\n                        var instance = {\r\n                            objectName: options.objectName,\r\n                            selector: null,\r\n                            properties: {}\r\n                        };\r\n                        for (var key in dataViewProperties) {\r\n                            if (dataViewProperties.hasOwnProperty(key)) {\r\n                                instance.properties[key] = dataViewProperties[key];\r\n                            }\r\n                        }\r\n                        return {\r\n                            instances: [instance]\r\n                        };\r\n                    };\r\n                    DataViewObjectsParser.prototype.getProperties = function () {\r\n                        var _this = this;\r\n                        var properties = {}, objectNames = Object.keys(this);\r\n                        objectNames.forEach(function (objectName) {\r\n                            if (DataViewObjectsParser.isPropertyEnumerable(objectName)) {\r\n                                var propertyNames = Object.keys(_this[objectName]);\r\n                                properties[objectName] = {};\r\n                                propertyNames.forEach(function (propertyName) {\r\n                                    if (DataViewObjectsParser.isPropertyEnumerable(objectName)) {\r\n                                        properties[objectName][propertyName] =\r\n                                            DataViewObjectsParser.createPropertyIdentifier(objectName, propertyName);\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                        return properties;\r\n                    };\r\n                    return DataViewObjectsParser;\r\n                }());\r\n                DataViewObjectsParser.InnumerablePropertyPrefix = /^_/;\r\n                dataview.DataViewObjectsParser = DataViewObjectsParser;\r\n            })(dataview = utils.dataview || (utils.dataview = {}));\r\n        })(utils = extensibility.utils || (extensibility.utils = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var rPivotTable8B3D024D64314B469FFC4852A7ACBD5F;\r\n            (function (rPivotTable8B3D024D64314B469FFC4852A7ACBD5F) {\r\n                \"use strict\";\r\n                var injectorCounter = 0;\r\n                function ResetInjector() {\r\n                    injectorCounter = 0;\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.ResetInjector = ResetInjector;\r\n                function injectorReady() {\r\n                    return injectorCounter === 0;\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.injectorReady = injectorReady;\r\n                function ParseElement(el, target) {\r\n                    var arr = [];\r\n                    if (!el || !el.hasChildNodes()) {\r\n                        return;\r\n                    }\r\n                    var nodes = el.children;\r\n                    for (var i = 0; i < nodes.length; i++) {\r\n                        var tempNode = void 0;\r\n                        if (nodes.item(i).nodeName.toLowerCase() === \"script\") {\r\n                            tempNode = createScriptNode(nodes.item(i));\r\n                        }\r\n                        else {\r\n                            tempNode = nodes.item(i).cloneNode(true);\r\n                        }\r\n                        target.appendChild(tempNode);\r\n                        arr.push(tempNode);\r\n                    }\r\n                    return arr;\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.ParseElement = ParseElement;\r\n                function createScriptNode(refNode) {\r\n                    var script = document.createElement(\"script\");\r\n                    var attr = refNode.attributes;\r\n                    for (var i = 0; i < attr.length; i++) {\r\n                        script.setAttribute(attr[i].name, attr[i].textContent);\r\n                        if (attr[i].name.toLowerCase() === \"src\") {\r\n                            // waiting only for src to finish loading - async opetation\r\n                            injectorCounter++;\r\n                            script.onload = function () {\r\n                                injectorCounter--;\r\n                            };\r\n                        }\r\n                    }\r\n                    script.innerHTML = refNode.innerHTML;\r\n                    return script;\r\n                }\r\n                function RunHTMLWidgetRenderer(callback) {\r\n                    // rendering HTML which was created by HTMLWidgets package\r\n                    // wait till all tje script elements are loaded\r\n                    var intervalVar = window.setInterval(function () {\r\n                        if (injectorReady()) {\r\n                            window.clearInterval(intervalVar);\r\n                            if (window.hasOwnProperty(\"HTMLWidgets\") && window[\"HTMLWidgets\"].staticRender) {\r\n                                if (window[\"HTMLWidgets\"].widgets\r\n                                    && window[\"HTMLWidgets\"].widgets[0]\r\n                                    && window[\"HTMLWidgets\"].widgets[0].renderValue) {\r\n                                    var originalRenderValue_1 = window[\"HTMLWidgets\"].widgets[0].renderValue;\r\n                                    window[\"HTMLWidgets\"].widgets[0].renderValue = function () {\r\n                                        var args = [];\r\n                                        for (var _i = 0; _i < arguments.length; _i++) {\r\n                                            args[_i] = arguments[_i];\r\n                                        }\r\n                                        args.forEach(function (arg) {\r\n                                            if (arg && arg.params) {\r\n                                                arg.params.onRefresh = [callback];\r\n                                            }\r\n                                        });\r\n                                        originalRenderValue_1.apply(void 0, args);\r\n                                    };\r\n                                }\r\n                                window[\"HTMLWidgets\"].staticRender();\r\n                            }\r\n                        }\r\n                    }, 100);\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.RunHTMLWidgetRenderer = RunHTMLWidgetRenderer;\r\n            })(rPivotTable8B3D024D64314B469FFC4852A7ACBD5F = visual.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F || (visual.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n/*\r\n *  Power BI Visualizations\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var rPivotTable8B3D024D64314B469FFC4852A7ACBD5F;\r\n            (function (rPivotTable8B3D024D64314B469FFC4852A7ACBD5F) {\r\n                \"use strict\";\r\n                var DataViewObjectsParser = powerbi.extensibility.utils.dataview.DataViewObjectsParser;\r\n                var VisualSettings = (function (_super) {\r\n                    __extends(VisualSettings, _super);\r\n                    function VisualSettings() {\r\n                        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n                        _this.rcv_script = new rcv_scriptSettings();\r\n                        return _this;\r\n                    }\r\n                    return VisualSettings;\r\n                }(DataViewObjectsParser));\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.VisualSettings = VisualSettings;\r\n                var rcv_scriptSettings = (function () {\r\n                    function rcv_scriptSettings() {\r\n                    }\r\n                    return rcv_scriptSettings;\r\n                }());\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.rcv_scriptSettings = rcv_scriptSettings;\r\n            })(rPivotTable8B3D024D64314B469FFC4852A7ACBD5F = visual.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F || (visual.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var rPivotTable8B3D024D64314B469FFC4852A7ACBD5F;\r\n            (function (rPivotTable8B3D024D64314B469FFC4852A7ACBD5F) {\r\n                /**\r\n                 * Gets property value for a particular object.\r\n                 *\r\n                 * @function\r\n                 * @param {DataViewObjects} objects - Map of defined objects.\r\n                 * @param {string} objectName       - Name of desired object.\r\n                 * @param {string} propertyName     - Name of desired property.\r\n                 * @param {T} defaultValue          - Default value of desired property.\r\n                 */\r\n                function getValue(objects, objectName, propertyName, defaultValue) {\r\n                    if (objects) {\r\n                        var object = objects[objectName];\r\n                        if (object) {\r\n                            var property = object[propertyName];\r\n                            if (property !== undefined) {\r\n                                return property;\r\n                            }\r\n                        }\r\n                    }\r\n                    return defaultValue;\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.getValue = getValue;\r\n                /**\r\n                 * Gets property value for a particular object.\r\n                 *\r\n                 * @function\r\n                 * @param {DataViewObjects} objects - Map of defined objects.\r\n                 * @param {string} objectName       - Name of desired object.\r\n                 * @param {string} propertyName     - Name of desired property.\r\n                 * @param {T} defaultValue          - Default value of desired property.\r\n                 */\r\n                function getValueMinMax(objects, objectName, propertyName, defaultValue, minVal, maxVal) {\r\n                    if (objects) {\r\n                        var object = objects[objectName];\r\n                        if (object) {\r\n                            var property = object[propertyName];\r\n                            if (property < minVal) {\r\n                                return minVal;\r\n                            }\r\n                            if (property > maxVal) {\r\n                                return maxVal;\r\n                            }\r\n                            if (property !== undefined) {\r\n                                return property;\r\n                            }\r\n                        }\r\n                    }\r\n                    return defaultValue;\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.getValueMinMax = getValueMinMax;\r\n                /**\r\n                * Gets property value for a particular object.\r\n                *\r\n                * @function\r\n                * @param {DataViewObjects} objects - Map of defined objects.\r\n                * @param {string} objectName       - Name of desired object.\r\n                * @param {string} propertyName     - Name of desired property.\r\n                * @param {T} defaultValue          - Default value of desired property.\r\n                */\r\n                function getValueNumberMinMax(objects, objectName, propertyName, defaultValue, minValue, maxValue) {\r\n                    if (objects) {\r\n                        var object = objects[objectName];\r\n                        if (object) {\r\n                            var property = object[propertyName];\r\n                            if (property !== undefined) {\r\n                                if (property > maxValue) {\r\n                                    return maxValue;\r\n                                }\r\n                                if (property < minValue) {\r\n                                    return minValue;\r\n                                }\r\n                                return property;\r\n                            }\r\n                        }\r\n                    }\r\n                    return defaultValue;\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.getValueNumberMinMax = getValueNumberMinMax;\r\n                /**\r\n                     * Gets conditional property value for a particular object of type string\r\n                     *\r\n                     * @function\r\n                     * @param {string} inVal     - current value of parameter\r\n                     * @param {string} contrVal   - control value\r\n                     * @param {string} contrVal2Compare     - specific string to be compared with contrVal\r\n                     * @param {boolean} logic          -  true / false \"logic\"\r\n                     * @param {string} outValIfCondTrue          - output value if comparison (contrVal == contrVal2Compare) comes out as \"logic\"\r\n                     */\r\n                function ifStringReturnString(inVal, contrVal, contrVal2Compare, outValIfCondTrue, logic, applyNow) {\r\n                    if (applyNow && contrVal === contrVal2Compare && logic === true)\r\n                        return outValIfCondTrue;\r\n                    if (applyNow && contrVal !== contrVal2Compare && logic === false)\r\n                        return outValIfCondTrue;\r\n                    return inVal;\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.ifStringReturnString = ifStringReturnString;\r\n                function inMinMax(a, mi, ma) {\r\n                    if (a < mi)\r\n                        return mi;\r\n                    if (a > ma)\r\n                        return ma;\r\n                    return a;\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.inMinMax = inMinMax;\r\n                /**\r\n                 * Gets property value for a particular object in a category.\r\n                 *\r\n                 * @function\r\n                 * @param {DataViewCategoryColumn} category - List of category objects.\r\n                 * @param {number} index                    - Index of category object.\r\n                 * @param {string} objectName               - Name of desired object.\r\n                 * @param {string} propertyName             - Name of desired property.\r\n                 * @param {T} defaultValue                  - Default value of desired property.\r\n                 */\r\n                function getCategoricalObjectValue(category, index, objectName, propertyName, defaultValue) {\r\n                    var categoryObjects = category.objects;\r\n                    if (categoryObjects) {\r\n                        var categoryObject = categoryObjects[index];\r\n                        if (categoryObject) {\r\n                            var object = categoryObject[objectName];\r\n                            if (object) {\r\n                                var property = object[propertyName];\r\n                                if (property !== undefined) {\r\n                                    return property;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    return defaultValue;\r\n                }\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.getCategoricalObjectValue = getCategoricalObjectValue;\r\n            })(rPivotTable8B3D024D64314B469FFC4852A7ACBD5F = visual.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F || (visual.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n/*\r\n *  Power BI Visual CLI\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var rPivotTable8B3D024D64314B469FFC4852A7ACBD5F;\r\n            (function (rPivotTable8B3D024D64314B469FFC4852A7ACBD5F) {\r\n                \"use strict\";\r\n                // to allow this scenario you should first the following JSON definition to the capabilities.json file\r\n                // under the \"objects\" property:\r\n                // \"settings\": {\r\n                //     \"displayName\": \"Visual Settings\",\r\n                //     \"description\": \"Visual Settings Tooltip\",\r\n                //     \"properties\": {\r\n                //         \"lineColor\": {\r\n                //         \"displayName\": \"Line Color\",\r\n                //         \"type\": { \"fill\": { \"solid\": { \"color\": true }}}\r\n                //         }\r\n                //     }\r\n                // }\r\n                // in order to improve the performance, one can update the <head> only in the initial rendering.\r\n                // set to 'true' if you are using different packages to create the widgets\r\n                var updateHTMLHead = false;\r\n                var renderVisualUpdateType = [\r\n                    powerbi.VisualUpdateType.Resize,\r\n                    powerbi.VisualUpdateType.ResizeEnd,\r\n                    powerbi.VisualUpdateType.Resize + powerbi.VisualUpdateType.ResizeEnd\r\n                ];\r\n                var Visual = (function () {\r\n                    function Visual(options) {\r\n                        if (options && options.element) {\r\n                            this.rootElement = options.element;\r\n                        }\r\n                        this.host = options.host;\r\n                        this.headNodes = [];\r\n                        this.bodyNodes = [];\r\n                        this.settings_rpivottable_params = {\r\n                            fontSize: \"12px\"\r\n                        };\r\n                    }\r\n                    Visual.prototype.update = function (options) {\r\n                        if (!options ||\r\n                            !options.type ||\r\n                            !options.viewport ||\r\n                            !options.dataViews ||\r\n                            options.dataViews.length === 0 ||\r\n                            !options.dataViews[0]) {\r\n                            return;\r\n                        }\r\n                        // console.log(options);\r\n                        var dataView = options.dataViews[0];\r\n                        this.settings = Visual.parseSettings(dataView);\r\n                        this.settings_rpivottable_params = {\r\n                            fontSize: rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.getValue(dataView.metadata.objects, 'settings_rpivottable_params', 'fontSize', \"12px\"),\r\n                        };\r\n                        console.log(this.settings_rpivottable_params);\r\n                        var payloadBase64 = null;\r\n                        if (dataView.scriptResult && dataView.scriptResult.payloadBase64) {\r\n                            payloadBase64 = dataView.scriptResult.payloadBase64;\r\n                        }\r\n                        if (renderVisualUpdateType.indexOf(options.type) === -1) {\r\n                            if (payloadBase64) {\r\n                                this.injectCodeFromPayload(payloadBase64);\r\n                            }\r\n                        }\r\n                        else {\r\n                            this.onResizing(options.viewport);\r\n                        }\r\n                    };\r\n                    Visual.prototype.onResizing = function (finalViewport) {\r\n                        /* add code to handle resizing of the view port */\r\n                    };\r\n                    Visual.prototype.keepSettings = function (settings) {\r\n                        if (settings === this.thePreviousSettingsInJson) {\r\n                            return;\r\n                        }\r\n                        this.thePreviousSettingsInJson = settings;\r\n                        // console.log(settings);\r\n                        this.host.persistProperties({\r\n                            merge: [{\r\n                                    objectName: \"internal_settings\",\r\n                                    properties: {\r\n                                        settings: settings\r\n                                    },\r\n                                    selector: null\r\n                                }]\r\n                        });\r\n                    };\r\n                    Visual.prototype.injectCodeFromPayload = function (payloadBase64) {\r\n                        // inject HTML from payload, created in R\r\n                        // the code is injected to the 'head' and 'body' sections.\r\n                        // if the visual was already rendered, the previous DOM elements are cleared\r\n                        var _this = this;\r\n                        rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.ResetInjector();\r\n                        if (!payloadBase64) {\r\n                            return;\r\n                        }\r\n                        // create 'virtual' HTML, so parsing is easier\r\n                        var el = document.createElement(\"html\");\r\n                        try {\r\n                            el.innerHTML = window.atob(payloadBase64);\r\n                        }\r\n                        catch (err) {\r\n                            return;\r\n                        }\r\n                        // if 'updateHTMLHead == false', then the code updates the header data only on the 1st rendering\r\n                        // this option allows loading and parsing of large and recurring scripts only once.\r\n                        if (updateHTMLHead || this.headNodes.length === 0) {\r\n                            while (this.headNodes.length > 0) {\r\n                                var tempNode = this.headNodes.pop();\r\n                                document.head.removeChild(tempNode);\r\n                            }\r\n                            var headList = el.getElementsByTagName(\"head\");\r\n                            if (headList && headList.length > 0) {\r\n                                var head = headList[0];\r\n                                this.headNodes = rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.ParseElement(head, document.head);\r\n                            }\r\n                        }\r\n                        // User-selected Format option styles\r\n                        var css = document.createElement(\"style\");\r\n                        css.type = \"text/css\";\r\n                        css.innerHTML = \".pvtVal { font-size: \" + this.settings_rpivottable_params.fontSize + \";} \" +\r\n                            \".pvtAttr { font-size: \" + this.settings_rpivottable_params.fontSize + \";} \" +\r\n                            \".pvtTotal { font-size: \" + this.settings_rpivottable_params.fontSize + \";} \" +\r\n                            \".pvtGrandTotal { font-size: \" + this.settings_rpivottable_params.fontSize + \";} \" +\r\n                            \".pvtAxisLabel { font-size: \" + this.settings_rpivottable_params.fontSize + \" !important;} \" +\r\n                            \".pvtRowLabel { font-size: \" + this.settings_rpivottable_params.fontSize + \" !important;} \" +\r\n                            \".pvtColLabel { font-size: \" + this.settings_rpivottable_params.fontSize + \" !important;} \";\r\n                        document.body.appendChild(css);\r\n                        // update 'body' nodes, under the rootElement\r\n                        while (this.bodyNodes.length > 0) {\r\n                            var tempNode = this.bodyNodes.pop();\r\n                            this.rootElement.removeChild(tempNode);\r\n                        }\r\n                        var bodyList = el.getElementsByTagName(\"body\");\r\n                        if (bodyList && bodyList.length > 0) {\r\n                            var body = bodyList[0];\r\n                            this.bodyNodes = rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.ParseElement(body, this.rootElement);\r\n                        }\r\n                        rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.RunHTMLWidgetRenderer(function (config) {\r\n                            console.log(config);\r\n                            _this.keepSettings(JSON.stringify(config));\r\n                        });\r\n                    };\r\n                    Visual.parseSettings = function (dataView) {\r\n                        return rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.VisualSettings.parse(dataView);\r\n                    };\r\n                    /**\r\n                     * This function gets called for each of the objects defined in the capabilities files and allows you to select which of the\r\n                     * objects and properties you want to expose to the users in the property pane.\r\n                     *\r\n                     */\r\n                    Visual.prototype.enumerateObjectInstances = function (options) {\r\n                        // VisualObjectInstance[] | VisualObjectInstanceEnumerationObject {\r\n                        // return VisualSettings.enumerateObjectInstances(this.settings || VisualSettings.getDefault(), options);\r\n                        var objectName = options.objectName;\r\n                        var objectEnumeration = [];\r\n                        switch (objectName) {\r\n                            case 'settings_rpivottable_params':\r\n                                objectEnumeration.push({\r\n                                    objectName: objectName,\r\n                                    properties: {\r\n                                        fontSize: this.settings_rpivottable_params.fontSize\r\n                                    },\r\n                                    selector: null\r\n                                });\r\n                        }\r\n                        return objectEnumeration;\r\n                    };\r\n                    return Visual;\r\n                }());\r\n                rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.Visual = Visual;\r\n            })(rPivotTable8B3D024D64314B469FFC4852A7ACBD5F = visual.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F || (visual.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var visuals;\r\n    (function (visuals) {\r\n        var plugins;\r\n        (function (plugins) {\r\n            plugins.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F_DEBUG = {\r\n                name: 'rPivotTable8B3D024D64314B469FFC4852A7ACBD5F_DEBUG',\r\n                displayName: 'R Pivot Table',\r\n                class: 'Visual',\r\n                version: '1.0.2.1',\r\n                apiVersion: '1.10.0',\r\n                create: function (options) { return new powerbi.extensibility.visual.rPivotTable8B3D024D64314B469FFC4852A7ACBD5F.Visual(options); },\r\n                custom: true\r\n            };\r\n        })(plugins = visuals.plugins || (visuals.plugins = {}));\r\n    })(visuals = powerbi.visuals || (powerbi.visuals = {}));\r\n})(powerbi || (powerbi = {}));\r\n//# sourceMappingURL=visual.js.map","css":".visual-rPivotTable8B3D024D64314B469FFC4852A7ACBD5F_DEBUG .rcv_autoScaleImageContainer {\n  position: relative;\n}\n.visual-rPivotTable8B3D024D64314B469FFC4852A7ACBD5F_DEBUG .rcv_autoScaleImageContainer .rcv_autoScaleImage {\n  width: 24px;\n  position: absolute;\n  top: 50%;\n  \n  left: 50%;\n  transform: translateY(-50%) translateX(-50%);\n  -webkit-transform: translateY(-50%) translateX(-50%);\n}\n.visual-rPivotTable8B3D024D64314B469FFC4852A7ACBD5F_DEBUG #htmlwidget_container {\n  height: 82vh;\n  overflow: auto;\n}\n.visual-rPivotTable8B3D024D64314B469FFC4852A7ACBD5F_DEBUG .pvtRows {\n  background-color: #3f3f3f;\n}\n.visual-rPivotTable8B3D024D64314B469FFC4852A7ACBD5F_DEBUG .pvtCols {\n  background-color: #3f3f3f;\n}\n.visual-rPivotTable8B3D024D64314B469FFC4852A7ACBD5F_DEBUG .pvtAxisLabel {\n  background-color: #3f3f3f;\n  color: #ffffff;\n}\n","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAFzUkdCAK7OHOkAAAAEZ0FNQQAAsY8L/GEFAAAACXBIWXMAABJ0AAASdAHeZh94AAABP0lEQVQ4T2PcvXv3fwYqAiYoTTVAdQMZb968+V9j8UMoFwFuxMozYBMHAVxyIHGcLlT7O5/hH3MuJpZ8xKCmpgZVhQkIezn8BgNDAwxPZ2B41Q2kK6GSmIDEMHQEWhAIpNcz/ItyhQihAdIjRVQFQr9+AKHRADhSoGwUAApDhpXrIV7WhAqCwHWgd6Hit5hvQQURgAVEYIuxf1FQBjJ4MxdimFgp2BI1IEQGt27dwp1s/kXtg2hGB+guRgIgA0mIZWAMg8BK3DEMAiRECjCGc4BeBcYwwyHsEQICJEYK0KBpHsC0GMhwKyoRKoYKSIsUBgWgQ4HpEGiR2t92jLAkLgzRgaYbhN4PjHEsgHQDQWGpA6RebQMmI4gIMsBp4C1mYBiBYhdLErmltwkot5aBQQQqgATIcCF+gDOWyQMMDAC2NXeMLHD1PgAAAABJRU5ErkJggg=="}}